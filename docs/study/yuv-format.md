# YUV 视频格式详解

## 1. 什么是 YUV

**YUV** 是一种颜色编码方式，广泛用于**视频编解码、视频采集、传输与渲染**领域。
它将图像信息拆分为：

* **Y（Luma，亮度）**
* **U（Cb，蓝色色度）**
* **V（Cr，红色色度）**

> 人眼对亮度比对颜色更敏感，因此 YUV 通过降低色度分辨率来减少数据量，同时保持视觉质量。

---

## 2. YUV 的设计思想

### 2.1 亮度与色度分离

* **Y**：决定画面的明暗（黑白图）
* **U / V**：决定颜色（色相、饱和度）

这种分离方式使得：

* 亮度可以高精度编码
* 色度可以低采样（节省带宽）

---

### 2.2 YUV 与 YCbCr

| 名称    | 使用场景 | 说明                     |
| ----- | ---- | ---------------------- |
| YUV   | 模拟视频 | 早期模拟电视制式               |
| YCbCr | 数字视频 | 实际工程中 **YUV 常指 YCbCr** |

> 在现代数字视频中（H.264 / H.265 / VP9 / AV1），**严格意义上使用的是 YCbCr，但工程中仍统称 YUV**

---

## 3. YUV 与 RGB 的对比

| 对比项   | RGB | YUV     |
| ----- | --- | ------- |
| 表示方式  | 红绿蓝 | 亮度 + 色度 |
| 数据冗余  | 高   | 低       |
| 人眼友好性 | 一般  | 高       |
| 编码压缩  | 不友好 | 非常友好    |
| 显示设备  | 显示器 | 编码 / 传输 |

### RGB → YUV（典型 BT.601）

```text
Y  =  0.299R + 0.587G + 0.114B
Cb = -0.1687R - 0.3313G + 0.5B + 128
Cr =  0.5R - 0.4187G - 0.0813B + 128
```

---

## 4. YUV 采样方式（核心重点）

YUV 格式的关键区别在于 **色度采样率**。

### 4.1 常见采样格式

| 格式     | 说明           | 亮度:色度 |
| ------ | ------------ | ----- |
| YUV444 | 不降采样         | 4:4:4 |
| YUV422 | 水平方向降 1/2    | 4:2:2 |
| YUV420 | 水平 + 垂直降 1/2 | 4:2:0 |

---

### 4.2 YUV444

* 每个像素都有独立的 Y / U / V
* 数据量最大，质量最高
* 多用于图像处理、后期

```text
Y U V | Y U V | Y U V | ...
```

---

### 4.3 YUV422

* **每 2 个像素共享一组 U / V**
* 水平方向降采样

```text
Y U V | Y     | Y U V | Y
```

📉 数据量约为 RGB 的 **2/3**

---

### 4.4 YUV420（最常用）

* **每 4 个像素共享一组 U / V**
* 水平 & 垂直均降采样

```text
Y Y
Y Y
U V
```

📌 **H.264 / H.265 / WebRTC / 摄像头 默认格式**

---

## 5. YUV 的存储布局（Plane vs Packed）

### 5.1 按 Plane 分类

#### 1️⃣ Planar（平面）

```text
YYYYYYYY
UUUU
VVVV
```

* Y、U、V 分开存储
* 编码器友好

✔ 常见：`I420 / YV12`

---

#### 2️⃣ Semi-Planar（半平面）

```text
YYYYYYYY
UVUVUVUV
```

* Y 单独
* UV 交错

✔ 常见：`NV12 / NV21`

---

#### 3️⃣ Packed（打包）

```text
YUYV | YUYV | YUYV
```

* 数据交错
* 采集设备常用

✔ 常见：`YUY2 / UYVY`

---

## 6. 常见 YUV 格式一览

### 6.1 YUV420 家族（重点）

| 格式   | 类型          | UV 顺序 |
| ---- | ----------- | ----- |
| I420 | Planar      | U → V |
| YV12 | Planar      | V → U |
| NV12 | Semi-Planar | U → V |
| NV21 | Semi-Planar | V → U |

📌 **Android Camera 输出：NV21**
📌 **iOS / 硬件编码器：NV12**

---

### 6.2 YUV422

| 格式   | 布局      |
| ---- | ------- |
| YUY2 | Y U Y V |
| UYVY | U Y V Y |

---

### 6.3 YUV444

* `YUV444P`
* `AYUV`

---

## 7. 内存大小计算

以 **YUV420** 为例：

```text
Y  : width × height
U  : (width / 2) × (height / 2)
V  : (width / 2) × (height / 2)
```

✅ **总大小 = width × height × 1.5 bytes**

### 示例：1080p

```text
1920 × 1080 × 1.5 ≈ 3 MB
```

---

## 8. YUV 在实际工程中的应用

### 8.1 视频编码

* H.264 / H.265 / AV1 全部基于 YUV
* 默认：**YUV420**

---

### 8.2 WebRTC

* 摄像头采集：NV12/NV21
* 传输编码：I420

---

### 8.3 GPU / 硬件加速

* iOS Metal / Android MediaCodec
* GPU 原生支持 YUV → RGB 转换

---

## 9. 常见问题（FAQ）

### Q1：为什么我的视频颜色发绿 / 发紫？

✅ **UV 顺序错误**

* NV12 ↔ NV21
* I420 ↔ YV12

---

### Q2：为什么画面模糊？

✅ 使用了 **YUV420 色度降采样**
👉 属于正常现象

---

### Q3：如何验证 YUV 数据是否正确？

* 使用 **ffplay**
* 使用 **YUV Player**
* 转换成 RGB 后查看

---

## 10. 总结

* **YUV 是以视觉感知为核心设计的色彩空间**
* 核心差异在于：

  * 采样方式（420 / 422 / 444）
  * 存储布局（Planar / Semi / Packed）
* **工程实践中最重要的是搞清楚：**

  * 格式（I420 / NV12 / NV21）
  * UV 顺序
  * stride / align

---

如果你需要下一步内容，我也可以继续帮你：

✅ **YUV → RGB 转换实现（C / Python / GLSL）**
✅ **H.264 中 YUV 的使用方式**
✅ **WebRTC 中 YUV 数据流解析**
✅ **摄像头 NV12 / NV21 实战排错指南**

只要告诉我 👍
